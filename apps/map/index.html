<!doctype html>
<html lang="en" joblist-layout>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>@joblist/components/map</title>
		<script type="module">
			import joblist from "../../src/index.js";
			const { sqlSdk, mapSdk } = joblist;
			const { companiesToMapMarkers } = mapSdk;
			(async ({
				$search = document.querySelector("joblist-search"),
				$map = document.querySelector("joblist-map-list"),
			} = {}) => {
				const handleSearch = ({ detail }) => {
					const { companies, query } = detail;
					if (!query) {
						$map.setAttribute("markers", JSON.stringify(allMarkers));
					} else if (query && companies) {
						/* @TODO there are no position on jobs yet */
						delete detail.jobs;
						const itemMarkers = companiesToMapMarkers(companies);
						$map.setAttribute("markers", JSON.stringify(itemMarkers));
					} else if (!companies) {
						$map.removeAttribute("results");
					}
				};
				await sqlSdk.initialize();
				const allCompanies = await sqlSdk.getAllCompaniesData();
				const allMarkers = companiesToMapMarkers(allCompanies);
				$search.addEventListener("search", handleSearch);
				$map.setAttribute("markers", JSON.stringify(allMarkers));
			})();
		</script>
	</head>
	<body>
		<joblist-layout>
			<joblist-menu>
				<menu>
					<li>
						<a href="./">map</a>
					</li>
				</menu>
				<menu>
					<li>
						<a href="../search/">search</a>
					</li>
				</menu>
				<menu>
					<li>
						<a href="https://joblist.today">joblist.today</a>
					</li>
				</menu>
			</joblist-menu>
			<joblist-page full>
				<joblist-search></joblist-search>
				<joblist-map-list
					latitude=""
					longitude=""
					zoom="3"
					origin="https://profiles.joblist.today/companies"
				></joblist-map-list>
			</joblist-page>
		</joblist-layout>
	</body>
</html>
